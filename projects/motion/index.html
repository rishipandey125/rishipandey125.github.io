
<!DOCTYPE html>
<html lang="en">
	<head>
		<title>motion</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	</head>
	<body>

		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.js"></script>
		
		<script type="module">
			import { ARButton } from 'https://cdn.jsdelivr.net/npm/three@0.146.0/examples/jsm/webxr/ARButton.js';
			let scene; 
			let camera;
			let renderer;
			let mesh;
			let controller;

			let startScale = getRandomInt(3);
			let endScale = getRandomInt(3);
			let startRot = Math.random() * 0.01;
			let endRot = Math.random() * 0.01;
			let startDetail = getRandomInt(10)
			let endDetail = getRandomInt(10)
			let startColor = new THREE.Color(Math.random(),Math.random(),Math.random())
			let endColor = new THREE.Color(Math.random(),Math.random(),Math.random())
			
			// 1 for scale 
			// 2 for rotation
			// 3 for isohedron detail  
			// 4 for color

			let animState = 3

			let numFrames = 0 


			function getRandomInt(max) {
				return Math.ceil(Math.random() * max);
			}

			function easeOutCirc(x) {
				return Math.sqrt(1 - Math.pow(x - 1, 2));
			}

			function mix(a,b,val) {
				let alpha = easeOutCirc(val)
				return a + (b-a)*alpha;
			}

			function mixColor(col1,col2,val) {
				let alpha = easeOutCirc(val)
				let r = mix(col1.r,col2.r,val);
				let g = mix(col1.g,col2.g,val);
				let b = mix(col1.b,col2.b,val);
				return new THREE.Color(r,g,b);
			}

			function updateGeometry(mesh, geo) {
				mesh.geometry.dispose()
				mesh.geometry = geo
			}

			init();
			animate();
			function init() {
				//setup the scene 
				scene = new THREE.Scene();
				camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

				//setup the renderer
				renderer = new THREE.WebGLRenderer( { antialias: true, alpha: true} );
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.xr.enabled = true
				document.body.appendChild( renderer.domElement );

				//add ar button to bottom of screen
				document.body.appendChild( ARButton.createButton( renderer ) );

				//create icosahedron 
				const geometry = new THREE.IcosahedronGeometry( 20, 4 );

				const material = new THREE.MeshBasicMaterial( {
					color: '#000000',
					wireframe: true
				} );

				//add mesh to screen
				mesh = new THREE.Mesh(
					new THREE.IcosahedronGeometry( 1, 4 ),
					material
				);
				scene.add( mesh );

				//ar controller

				controller = renderer.xr.getController( 0 );
				// controller.addEventListener( 'selectstart', onSelectStart );
				// controller.addEventListener( 'selectend', onSelectEnd );
				controller.userData.skipFrames = 0;
				
				scene.add( controller );

				camera.position.z = 5;
			}

			function animate(time) {
				//call anim loop
				renderer.setAnimationLoop( animate );
				
				// if the user is using AR
				if (renderer.xr.isPresenting) {
					scene.scale.set( 0.3, 0.3, 0.3 );
					// renderer.alpha = true
					// mesh.material.color =  new THREE.Color(0,0,1);
					// mesh.material.color = mixColor(startColor,endColor,alpha);
				}

				numFrames += 1 // update frames

				let alpha = numFrames / 40; //how long the anim cycle lasts	
				
				// 1 for scale 
				// 2 for rotation
				// 3 for Icosahedron detail 
				// 4 for color

				if (animState == 1) {
					let scale = mix(startScale,endScale,alpha)
					mesh.scale.x = scale
					mesh.scale.y = scale
					mesh.scale.z = scale
				} else if (animState == 2) {
					let rot = mix(startRot,endRot,alpha);
					mesh.rotation.x += rot;
					mesh.rotation.y += rot;
					mesh.rotation.z += rot;
				} else if (animState == 3) {
					updateGeometry(mesh, new THREE.IcosahedronGeometry( 1, Math.ceil(mix(startDetail,endDetail,alpha)))); 
				} else if (animState == 4) {
					mesh.material.color = mixColor(startColor,endColor,alpha);
				}

				// if the anim cycle is finished 
				if (alpha == 1) {
					numFrames = 0 //reset frame count
					animState = getRandomInt(4) //change anim state

					if (animState == 1) {
						//update scale values
						startScale = endScale 
						endScale = getRandomInt(3)
					} else if (animState == 2) {
						startRot = endRot
						endRot = Math.random() * 0.01
					} else if (animState == 3) {
						startDetail = endDetail
						endDetail = getRandomInt(10)
					} else if (animState == 4) {	
						startColor = endColor
						endColor = new THREE.Color(Math.random(),Math.random(),Math.random())
					}
				}
				renderer.render( scene, camera );
			};

		</script>
	</body>
</html>